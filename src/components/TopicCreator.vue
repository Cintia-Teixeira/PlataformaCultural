<template>
  <div class="app-component stepper">
    <!-- header -->
    <div class="stepper-header">
      <identity
        class="identity"
        :black-mode="true"
      />
      <progress-bar
        class="progressbar"
        :current-step="currentStep"
        :steps-title="stepsTitle"
      />
      <color-line class="color-line" />
    </div>
    <!-- content -->
    <div class="stepper-content">
      <!-- SECTION 1 -->
      <section
        v-if="currentStep === 1"
        id="section1"
        class="stepper-section"
      >
        <span class="title-1 bolder mg-top16">Sobre os Di√°logos</span>
        <span class="headline-2 bolder mg-top16">Di√°logos abertos</span>
        <p class="body-2 mg-top8 justify-text">
          Voc√™ poder√° iniciar um debate, que aqui chamamos de di√°logo, para compartilhar pontos de vista com outras pessoas sobre os assuntos
          que te preocupam em rela√ß√£o √† cultura em Campo Grande.
          O espa√ßo de di√°logos abertos √© destinado aos gestores, produtores, promotores da cultura local e tamb√©m √† comunidade art√≠stica. Sendo um desses agentes,
          voc√™ poder√° expor seus argumentos e abrir uma conversa com todos.
          Considere que o debate n√£o aciona nenhum mecanismo de atua√ß√£o concreta. Mas alimenta as tomadas de decis√£o do F√≥rum Municipal de Cultura,
          identifica a necessidade de encontros presenciais espec√≠ficos (assembleias, reuni√µes) como tamb√©m contribui para a compreens√£o das necessidades da
          comunidade art√≠stica de Campo Grande.
        </p>
        <span class="headline-2 bolder mg-top16"> Recomenda√ß√µes para participar de um di√°logo aberto</span>
        <p class="body-2 mg-top8 justify-text">
          1. Para iniciar um debate √© necess√°rio que voc√™ fa√ßa um cadastro na
          <router-link class="link" to="/signUp"><strong>Plataforma Cartografia da Cultura</strong></router-link>.
          Os usu√°rios cadastrados tamb√©m podem participar das discuss√µes j√° iniciadas atrav√©s dos coment√°rios e/ ou indicar se concorda ou n√£o concorda
          clicando nos bot√µes ‚Äúüëç‚Äù ou ‚Äúüëé‚Äù encontrados em cada debate proposto.
        </p>
        <p class="body-2 mg-top8 justify-text">
          2. N√£o escreva o t√≠tulo do debate ou frases inteiras em letras mai√∫sculas. Na Internet, isso √© considerado o mesmo que gritar. E ningu√©m gosta disso.
        </p>
        <p class="body-2 mg-top8 justify-text">
          3. Qualquer debate ou coment√°rio que implique em uma a√ß√£o ilegal ser√° deletado. Tamb√©m  ser√£o deletados coment√°rios que tenham a inten√ß√£o de sabotar o espa√ßo de debate.
        </p>
        <p class="body-2 mg-top8 justify-text">
          4. As cr√≠ticas duras s√£o bem vindas. Este √© um espa√ßo de pensamento livre, mas recomendamos que, ainda que a cr√≠tica seja dura, tamb√©m seja gentil e inteligente.
        </p>
        <p class="body-2 mg-top8 justify-text">
          5. Desfrute deste espa√ßo, das vozes que o preenchem, ele tamb√©m √© seu.
        </p>
      </section>
      <!-- SECTION 2 -->
      <section
        v-if="currentStep === 2"
        id="section2"
        class="stepper-section"
      >
        <span class="title-1 bolder mg-top16">Regras para iniciar um di√°logo</span>
        <!-- 1 -->
        <span class="body-2 bolder mg-top32">1. Uma vez feito o login, voc√™ poder√°:</span>
        <ol>
          <li class="body-2 justify-text">
            Iniciar um debate.
          </li>
          <li class="body-2 justify-text">
            Participar de um debate j√° iniciado por outro usu√°rio.
          </li>
          <li class="body-2 justify-text">
            Concordar ou n√£o concordar ao votar em um debate iniciado.
          </li>
        </ol>
        <!-- 2 -->
        <span class="body-2 bolder mg-top24">2. Para iniciar o debate: </span>
        <ol class="list">
          <li class="body-2 justify-text">
            insira um t√≠tulo que represente o assunto principal da discuss√£o.
          </li>
          <li class="body-2 justify-text">
            insira um texto com sua argumenta√ß√£o diretamente na plataforma.
          </li>
          <li class="body-2 justify-text">
            escolha uma ou mais categorias relacionada ao assunto que quer discutir.
          </li>
        </ol>
        <!-- 3 -->
        <span class="body-2 bolder mg-top24">3. Uma vez iniciado o debate, voc√™ n√£o poder√°: </span>
        <ol class="list">
          <li class="body-2 justify-text">
            deletar o debate que voc√™ iniciou;
          </li>
          <li class="body-2 justify-text">
            deletar um coment√°rio em um debate que voc√™ participou.
          </li>
        </ol>
        <!-- 4 -->
        <span class="body-2 bolder mg-top24">4. Ser√£o deletados: </span>
        <ol class="list">
          <li class="body-2 justify-text">
            os coment√°rios ofensivos, com discurso de √≥dio ou qualquer ato de comunica√ß√£o que inferiorize ou incite contra uma pessoa ou grupo,
            tendo por base caracter√≠sticas como ra√ßa, g√™nero, etnia, nacionalidade, religi√£o, orienta√ß√£o sexual ou outro aspecto pass√≠vel de discrimina√ß√£o.
          </li>
          <li class="body-2 justify-text">
            qualquer coment√°rio que implique em uma a√ß√£o ilegal ou que tenham a inten√ß√£o de sabotar o espa√ßo de debate.
          </li>
        </ol>
        <!-- 5 -->
        <span class="body-2 bolder mg-top24">5. Recomendamos que: </span>
        <ol class="list">
          <li class="body-2 justify-text">
            Insira um texto revisado por voc√™. Veja se est√° claro e objetivo.
          </li>
          <li class="body-2 justify-text">
            Seja gentil ao dialogar com as outras vozes que t√™m pontos de vista diferente do seu.
          </li>
        </ol>
        <!-- ACCEPT TERMS -->
        <div class="accept-rules row al-items-center">
          <q-checkbox
            v-model="acceptRules"
            size="32px"
            color="black"
            true-value="item.category"
          />
          <span class="body-2 mg-left8">Eu li e concordo com as regras da plataforma.</span>
          <span class="caption mg-left8">( voc√™ deve marcar essa op√ß√£o para continuar )</span>
        </div>
      </section>
      <!-- SECTION 3 -->
      <section
        v-if="currentStep === 3"
        class="stepper-section"
      >
        <span class="title-2 bolder mg-top16">Crie seu di√°logo</span>
        <span class="headline-2 bolder mg-top16">T√≠tulo do seu di√°logo</span>
        <!-- TITLE -->
        <q-input
          v-model="title"
          class="input"
          dense
          square
          filled
          bottom-slots
          :error="$v.title.$error"
          :error-message="titleErrorMessage"
          @blur="$v.title.$touch"
        />

        <span class="headline-2 bolder">Texto do Di√°logo</span>
        <!-- CONTENT -->
        <q-input
          v-model="content"
          class="input"
          counter
          dense
          autogrow
          square
          filled
          bottom-slots
          hint="m√°ximo de 2000 caracteres"
          :error="$v.content.$error"
          :error-message="contentErrorMessage"
          @blur="$v.content.$touch"
        />
        <!-- CATEGORY -->
        <div class="category column mg-top16">
          <span class="headline-2 bolder">Identifique sua categoria</span>
          <span class="body-3">Marque as op√ß√µes que se relacionam ao seu di√°logo</span>
          <div class="list mg-top8">
            <q-list id="item" v-for="item in options" :key="item.value">
              <q-item clickable @click="selectCategory(item)">
                <q-item-section avatar>
                  <!-- iconId -1 : index of array of icons (0 a 17) -->
                  <icon-base :iconId="item.value -1" width="16" :setWhite="active" />
                </q-item-section>
                <q-item-section :id="item.value" class="body-3 bolder" :class="{ 'white' : active }"> {{ item.label }} </q-item-section>
              </q-item>
            </q-list>
          </div>
        </div>
      </section>
    </div>
    <!-- FOOTER -->
    <div class="stepper-footer">
      <!-- CANCEL -->
      <base-button
        v-if="currentStep === 1"
        class="stepper-btn"
        theme="flat"
        @click="cancel()"
      >
        <i class="fas fa-times btn-icon"></i>
        <span class="body-3 bolder stepper-btn-span mg-left16"> cancelar </span>
      </base-button>
      <!-- BACK -->
      <base-button
        v-if="currentStep != 1"
        class="stepper-btn"
        theme="flat"
        @click="prevStep()"
      >
        <i class="fas fa-arrow-left btn-icon"></i>
        <span class="body-3 bolder stepper-btn-span mg-left16"> voltar </span>
      </base-button>
      <base-button
        v-if="currentStep != numberOfSteps"
        class="stepper-btn"
        theme="flat"
        @click="nextStep()"
      >
        <span class="body-3 bolder stepper-btn-span text-uppercase"> Continuar </span>
        <i class="fas fa-arrow-right btn-icon mg-left16"></i>
      </base-button>
      <base-button
        v-if="currentStep === numberOfSteps"
        class="stepper-btn"
        theme="secondary"
        @click="finish()"
      >
        <!-- <i class="fas fa-plus reply-icon"></i> -->
        <span class="body-3 bolder text-uppercase"> Iniciar di√°logo </span>
      </base-button>
    </div>
  </div>
</template>

<script>
import { required, minLength, maxLength } from 'vuelidate/lib/validators';
import { mapGetters } from 'vuex';

import Identity from './Logo.vue';
import ColorLine from './ColorLine.vue';
import ProgressBar from './BaseStepProgressBar.vue';
import BaseButton from './BaseButton.vue';
import iconBase from './iconBase.vue';

export default {
  name: 'TopicCreator',
  components: {
    Identity,
    ColorLine,
    ProgressBar,
    BaseButton,
    iconBase,
  },
  data() {
    return {
      currentStep: 3,
      count: 0,
      numberOfSteps: 3,
      stepsTitle: ['O que s√£o os Di√°logos', 'Regras', 'Crie seu Di√°logo'],
      acceptRules: false,
      title: '',
      content: '',
      categoryId: null,
    };
  },
  validations: {
    title: {
      required,
      minLength: minLength(3),
      validChars: (value) => (/^[a-zA-Z0-9_]+$/ig).test(value),
    },
    content: {
      required,
      maxLength: maxLength(2000),
    },
  },
  computed: {
    ...mapGetters({
      options: 'categories/loadCategories',
    }),
    formIsValid() {
      if (this.$v.$anyError || this.selected === null || this.terms === false) {
        return false;
      }
      return true;
    },
    titleErrorMessage() {
      if (!this.$v.title.required) {
        return 'Esse campo √© requerido';
      }
      if (!this.$v.title.validChars) {
        return 'Este campo deve conter apenas letras, n√∫meros e underline';
      }
      if (!this.$v.title.minLength) {
        return 'M√≠nimo de tr√™s d√≠gitos';
      }
      return '';
    },
    contentErrorMessage() {
      if (!this.$v.title.required) {
        return 'Esse campo √© requerido';
      }
      if (!this.$v.title.minLength) {
        return 'M√≠nimo de tr√™s d√≠gitos';
      }
      return '';
    },
  },
  methods: {
    selectCategory(el) {
      console.log('category', el);
      this.categoryId = el.value;
    },
    nextStep() {
      if (this.count <= (this.numberOfSteps)) {
        this.currentStep += 1;
        this.count += 1;
      }
    },
    prevStep() {
      if (this.count >= 0) {
        this.currentStep -= 1;
        this.count -= 1;
      }
    },
  },
};
</script>

<style lang="scss" scoped>
@import '../styles/variables.scss';
@import '../styles/mixins.scss';

$height: 32px;
$width: 32px;
$line-height: 32px;
$primaryColor: black;
$secondaryColor: #ddd;

.stepper {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  justify-content: space-between;
  margin-bottom: 50px;
  // border: 1px solid #ddd;
}

.stepper-header {
  width: 100%;
  padding: 16px;
  padding-bottom: 0;
  // border-bottom: 1px solid #ddd;

  .progressbar {
    margin-top: 24px;
    // display: none;
  }

  .identity {
    display: none;
    margin: 16px 0 32px 0;
  }

  .color-line {
    margin-top: 32px;
  }
}

.stepper-content {
  width: 100%;
  height: 100%;
  padding: 16px;
  // border: 1px solid red;
}

section {
  display: flex;
  flex-direction: column;
  opacity: 1;
  animation-name: fadeInOpacity;
  animation-iteration-count: 1;
  animation-timing-function: cubic-bezier(0.075, 0.82, 0.165, 1);
  animation-duration: 1s;
}

ol {
  list-style: lower-latin;
  margin: 0;
}

li {
  margin-left: 32px;
}

.accept-rules {
  margin-top: 32px;
}

.link {
  text-decoration: none;
  color: black;
}

.justify-text {
  text-align: justify;
}

@keyframes fadeInOpacity {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}

.input {
  margin-top: 4px;
  margin-bottom: 8px;
}

.stepper-footer {
  width: 100%;
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  justify-content: space-around;
  margin: 32px 0;
  padding: 0 16px;
  padding-bottom: 16px;
  border-bottom: 1px solid #ddd;
}

.stepper-btn {
  min-width: 150px;
  transition: 1s ease-in-out;
}

.btn-icon {
  color: $gray2;
}

.stepper-btn-span {
  color: $primaryColor !important;
  letter-spacing: 1px;
}

</style>
